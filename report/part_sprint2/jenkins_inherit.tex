\chapter{Restructuring of Jenkins}
The setup of Jenkins used in sprint 1 was tedious to work with since all jobs were configured independently. If a change had to be made to several jobs, we would have to manually configure the change in each job. Not only did this take a considerable amount of time, but it was also prone to human errors during the process. In this sprint, we have to make small modifications to all jobs several times. This would be very tedious, so we have decided make job configurations easier to manage, even though it is not connected directly to a story. We consider it refactoring.
The jobs on Jenkins are generally very similar in their configuration. We can benefit from having a base configuration, which the jobs only modify. There exists a Jenkins plug-in for this, called inheritance-plugin \parencite{jenkins-inheritance}. With this plug-in installed, whenever we decide to make a change to e.g.\ the build system, it will not be necessary to change this in each job. Instead, the change can be made on the base job, and all relevant jobs will inherit this change. This also ensures that jobs follow a consistent pipeline and thus do not differ in from job to job.

The plug-in requires the jobs to be of a special \emph{inheritable} type. We therefore have to covert the existing jobs to inheritable jobs to take advantage of this. As it is impossible to convert a existing job to the inheritable type, we have to re-create all the jobs again. This is not that big of a deal, as the time to setup will be considerably shorter when taking advantage of the inheritable job type. When the old jobs are removed the build history will be lost. This is a minor nuisance but we consider it a small price to pay, compared to the advantages. When deciding how to structure the build, we see two general categories that are sufficiently distinct: Android apps and Android libraries. We create an abstract job for each of these. They do overlap somewhat in functionality, which means we have to create an abstract job for each job task. As such we create abstract jobs for e.g.\ \emph{run Gradle}, \emph{run unit tests}, \emph{find and move APKs}, and \emph{publish lint report}. The abstract jobs \emph{Android app} and \emph{Android library} inherit from the small abstract tasks that are relevant.

We have modelled this as an OOP class diagram in \figureref{fig:jenkins_inherit}.

\begin{figure}%
\centering
\tikzsetnextfilename{jenkins_inherit}
\begin{tikzpicture}[
  simple/.style={draw, rounded corners, minimum height=1.8em},
  simplefixed/.style={draw, rounded corners, minimum height=1.8em, minimum width=10em},
  square/.style={draw, rounded corners, minimum height=1.4em, minimum width=1.4em}]
  
  \begin{scope}[]
    \matrix[column sep=.5cm]{
      \node[simple] (pubAPK) {Publish APK}; &
      \node[simple] (email) {Email}; &
      \node[simple] (coco) {CoCo}; &
      \node[] (dots) {\dots};  &
      \node[simple] (emu) {Emulator}; &
      \node[simple] (pubLib) {Publish lib}; \\
    };
  \end{scope}
  
  \begin{scope}[yshift=-2cm]
    \matrix[column sep=1.5cm]{
      \node[simplefixed] (appInh) {App Inheritable}; &
      \node[simplefixed] (libInh) {Lib Inheritable}; \\
    };
  \end{scope}
  
  \begin{scope}[yshift=-3.5cm]
    \matrix[column sep=.3cm]{
      \node[simple] (app1) {App 1}; &
      \node[simple, right=of app1] (app2) {App 2}; &
      \node[right=of app2] (dots) {\dots}; &
      \node[simple, right=of dots] (appn) {App $n$}; &
      \node[] (dummy) {}; &
      \node[] (dummy2) {}; &
      \node[simple] (lib1) {Lib 1}; &
      \node[simple, right=of lib1] (lib2) {Lib 2}; &
      \node[right=of lib2] (dots) {\dots}; &
      \node[simple, right=of dots] (libn) {Lib $n$}; \\
    };
  \end{scope}

  \draw[<-] (appInh) to (app1);
  \draw[<-] (appInh) to (app2);
  \draw[<-] (appInh) to (appn);
  \draw[<-] (libInh) to (lib1);
  \draw[<-] (libInh) to (lib2);
  \draw[<-] (libInh) to (libn);
  
  \draw[<-] (pubAPK) to (appInh);
  \draw[<-] (email) to (appInh);
  \draw[<-] (coco) to (appInh);
  \draw[<-] (emu) to (appInh);
  
  \draw[<-] (pubLib) to (libInh);
  \draw[<-] (email) to (libInh);
  \draw[<-] (coco) to (libInh);
  \draw[<-] (emu) to (libInh);
        
  %\draw[decorate, line width=1pt, decoration={brace, mirror}] ([xshift=1.5em]g12.south east) -- ([xshift=1.5em]g12.north east) node [midway, yshift=-0.1em, xshift=2.2em] {Groups};
  
  %\draw[decorate, line width=1pt, decoration={brace, mirror}] ([xshift=1.5em]bd.south east) -- ([xshift=1.5em]bd.north east) node [midway, yshift=-0.1em, xshift=3.2em] {Subprojects};
  
\end{tikzpicture}
\caption{Jenkins inheritable jobs}%
\label{fig:jenkins_inherit}%
\end{figure}
