\chapter{Easy App Download and Installation}
The user story \emph{Easy Download and Installation of all Apps} describes that developers want to be able to easily install the the most recent versions of all apps on their devices. To solve this problem, we develop a script which downloads the most recent apps from the FTP server. The solution must work on both Unix systems and Windows without any additional software.

\section{Keeping Track of Newest Apps}
When new applications are built on Jenkins, we upload them to the Giraf FTP server. To keep the download script simple, we extend this upload functionality to also create a symbolic link to the newest version in a \mono{newest\_releases/} directory. This directory contains only one link per app, and thus allows us avoid finding the newest release in a directory containing all releases. Now, we can simply download all files in this directory to have the most recent versions of all apps.

\section{Downloading and Installing Apps}
Because we keep track of the newest apps on the build server, only little work is to be done in the download script. Because of this, we allow ourselves to develop two different scripts: A bash script for Unix and a Powershell script for Windows. These scripts first connect to the FTP server and downloads the apps. Afterwards, it reinstalls each app on a connected device.

The Unix script can be seen in \listingref{lst:download_install_apks_unix}. We connect to the FTP with the \code{-i -n} options that disables prompting when downloading multiple files and disables auto login, respectively (line \ref{download_install_apks:ftp_start}). Having connected we specify that the files to be downloaded are binary, get all files in the newest releases directory and quit (lines \ref{download_install_apks:binary}--\ref{download_install_apks:quit}). We then install the downloaded APKs onto a connected device (lines \ref{download_install_apks:installing_start}--\ref{download_install_apks:installing_stop}). The Powershell script can be seen in \appendixref{app:download_and_install_apks_windows} and works similarly.

Because the scripts do not require any additional software and because they download and install all applications automatically, this solution comply with the conditions of satisfaction of the user story.

\begin{lstlisting}[language=bash,caption=Unix script that downloads and installs newest APKs,label=lst:download_install_apks_unix]
#!/bin/bash
ftp -i -n ftp://ftpuser:9scWKbP@cs-cust06-int.cs.aau.dk/newest_releases/ << EOF (*@\label{download_install_apks:ftp_start}@*)
    binary (*@\label{download_install_apks:binary}@*)
    mget * (*@\label{download_install_apks:mget}@*)
    quit (*@\label{download_install_apks:quit}@*)
EOF

COUNTER=0 (*@\label{download_install_apks:installing_start}@*)
for f in *.apk
do
    echo "Trying to Uninstall $f"
    adb uninstall ${f%'.apk'}
    echo "Installing $f"
    adb install -r "$f"
    COUNTER=$(expr $COUNTER + 1)
done (*@\label{download_install_apks:installing_stop}@*)
echo "Installed $COUNTER apps"
exit 0
\end{lstlisting}